{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Administrator\\\\Desktop\\\\ctrip\\u9879\\u76EE\\\\mobile\\\\context\\\\AuthContext.js\";\nimport React, { createContext, useContext, useState, useEffect } from 'react';\nimport { login, register, logout, checkAuthState } from '../api/authService';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = createContext();\nexport const AuthProvider = ({\n  children\n}) => {\n  const [authState, setAuthState] = useState({\n    isAuthenticated: false,\n    user: null,\n    token: null,\n    loading: true\n  });\n  useEffect(() => {\n    const initAuth = async () => {\n      const state = await checkAuthState();\n      setAuthState({\n        isAuthenticated: state.isAuthenticated,\n        user: state.user,\n        token: state.token,\n        loading: false\n      });\n    };\n    initAuth();\n  }, []);\n  const handleLogin = async (username, password) => {\n    setAuthState(prev => Object.assign({}, prev, {\n      loading: true\n    }));\n    const result = await login(username, password);\n    if (result.success) {\n      setAuthState({\n        isAuthenticated: true,\n        user: result.user,\n        token: result.token,\n        loading: false\n      });\n    } else {\n      setAuthState(prev => Object.assign({}, prev, {\n        loading: false\n      }));\n    }\n    return result;\n  };\n  const handleRegister = async formData => {\n    setAuthState(prev => Object.assign({}, prev, {\n      loading: true\n    }));\n    const result = await register(formData);\n    if (result.success) {\n      setAuthState({\n        isAuthenticated: true,\n        user: result.user,\n        token: result.token,\n        loading: false\n      });\n    } else {\n      setAuthState(prev => Object.assign({}, prev, {\n        loading: false\n      }));\n    }\n    return result;\n  };\n  const handleLogout = async () => {\n    setAuthState(prev => Object.assign({}, prev, {\n      loading: true\n    }));\n    const result = await logout();\n    if (result.success) {\n      setAuthState({\n        isAuthenticated: false,\n        user: null,\n        token: null,\n        loading: false\n      });\n    } else {\n      setAuthState(prev => Object.assign({}, prev, {\n        loading: false\n      }));\n    }\n    return result;\n  };\n  const value = {\n    authState,\n    login: handleLogin,\n    register: handleRegister,\n    logout: handleLogout\n  };\n  return _jsxDEV(AuthContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 96,\n    columnNumber: 10\n  }, this);\n};\nexport const useAuth = () => {\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n};","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","login","register","logout","checkAuthState","jsxDEV","_jsxDEV","AuthContext","AuthProvider","children","authState","setAuthState","isAuthenticated","user","token","loading","initAuth","state","handleLogin","username","password","prev","Object","assign","result","success","handleRegister","formData","handleLogout","value","Provider","fileName","_jsxFileName","lineNumber","columnNumber","useAuth","context","Error"],"sources":["C:/Users/Administrator/Desktop/ctrip项目/mobile/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from 'react';\r\nimport { login, register, logout, checkAuthState } from '../api/authService';\r\n\r\n// 创建上下文\r\nconst AuthContext = createContext();\r\n\r\n// 创建提供者组件\r\nexport const AuthProvider = ({ children }) => {\r\n  const [authState, setAuthState] = useState({\r\n    isAuthenticated: false,\r\n    user: null,\r\n    token: null,\r\n    loading: true,\r\n  });\r\n\r\n  // 初始化时检查认证状态\r\n  useEffect(() => {\r\n    const initAuth = async () => {\r\n      const state = await checkAuthState();\r\n      setAuthState({\r\n        isAuthenticated: state.isAuthenticated,\r\n        user: state.user,\r\n        token: state.token,\r\n        loading: false,\r\n      });\r\n    };\r\n\r\n    initAuth();\r\n  }, []);\r\n\r\n  // 登录方法\r\n  const handleLogin = async (username, password) => {\r\n    setAuthState(prev => ({ ...prev, loading: true }));\r\n    const result = await login(username, password);\r\n    \r\n    if (result.success) {\r\n      setAuthState({\r\n        isAuthenticated: true,\r\n        user: result.user,\r\n        token: result.token,\r\n        loading: false,\r\n      });\r\n    } else {\r\n      setAuthState(prev => ({ ...prev, loading: false }));\r\n    }\r\n    \r\n    return result;\r\n  };\r\n\r\n  // 注册方法\r\n  const handleRegister = async (formData) => {\r\n    setAuthState(prev => ({ ...prev, loading: true }));\r\n    const result = await register(formData);\r\n    \r\n    if (result.success) {\r\n      setAuthState({\r\n        isAuthenticated: true,\r\n        user: result.user,\r\n        token: result.token,\r\n        loading: false,\r\n      });\r\n    } else {\r\n      setAuthState(prev => ({ ...prev, loading: false }));\r\n    }\r\n    \r\n    return result;\r\n  };\r\n\r\n  // 登出方法\r\n  const handleLogout = async () => {\r\n    setAuthState(prev => ({ ...prev, loading: true }));\r\n    const result = await logout();\r\n    \r\n    if (result.success) {\r\n      setAuthState({\r\n        isAuthenticated: false,\r\n        user: null,\r\n        token: null,\r\n        loading: false,\r\n      });\r\n    } else {\r\n      setAuthState(prev => ({ ...prev, loading: false }));\r\n    }\r\n    \r\n    return result;\r\n  };\r\n\r\n  // 提供的值\r\n  const value = {\r\n    authState,\r\n    login: handleLogin,\r\n    register: handleRegister,\r\n    logout: handleLogout,\r\n  };\r\n\r\n  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;\r\n};\r\n\r\n// 创建钩子以便在组件中使用\r\nexport const useAuth = () => {\r\n  const context = useContext(AuthContext);\r\n  if (!context) {\r\n    throw new Error('useAuth must be used within an AuthProvider');\r\n  }\r\n  return context;\r\n}; "],"mappings":";AAAA,OAAOA,KAAK,IAAIC,aAAa,EAAEC,UAAU,EAAEC,QAAQ,EAAEC,SAAS,QAAQ,OAAO;AAC7E,SAASC,KAAK,EAAEC,QAAQ,EAAEC,MAAM,EAAEC,cAAc,QAAQ,oBAAoB;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAG7E,MAAMC,WAAW,GAAGV,aAAa,CAAC,CAAC;AAGnC,OAAO,MAAMW,YAAY,GAAGA,CAAC;EAAEC;AAAS,CAAC,KAAK;EAC5C,MAAM,CAACC,SAAS,EAAEC,YAAY,CAAC,GAAGZ,QAAQ,CAAC;IACzCa,eAAe,EAAE,KAAK;IACtBC,IAAI,EAAE,IAAI;IACVC,KAAK,EAAE,IAAI;IACXC,OAAO,EAAE;EACX,CAAC,CAAC;EAGFf,SAAS,CAAC,MAAM;IACd,MAAMgB,QAAQ,GAAG,MAAAA,CAAA,KAAY;MAC3B,MAAMC,KAAK,GAAG,MAAMb,cAAc,CAAC,CAAC;MACpCO,YAAY,CAAC;QACXC,eAAe,EAAEK,KAAK,CAACL,eAAe;QACtCC,IAAI,EAAEI,KAAK,CAACJ,IAAI;QAChBC,KAAK,EAAEG,KAAK,CAACH,KAAK;QAClBC,OAAO,EAAE;MACX,CAAC,CAAC;IACJ,CAAC;IAEDC,QAAQ,CAAC,CAAC;EACZ,CAAC,EAAE,EAAE,CAAC;EAGN,MAAME,WAAW,GAAG,MAAAA,CAAOC,QAAQ,EAAEC,QAAQ,KAAK;IAChDT,YAAY,CAACU,IAAI,IAAAC,MAAA,CAAAC,MAAA,KAAUF,IAAI;MAAEN,OAAO,EAAE;IAAI,EAAG,CAAC;IAClD,MAAMS,MAAM,GAAG,MAAMvB,KAAK,CAACkB,QAAQ,EAAEC,QAAQ,CAAC;IAE9C,IAAII,MAAM,CAACC,OAAO,EAAE;MAClBd,YAAY,CAAC;QACXC,eAAe,EAAE,IAAI;QACrBC,IAAI,EAAEW,MAAM,CAACX,IAAI;QACjBC,KAAK,EAAEU,MAAM,CAACV,KAAK;QACnBC,OAAO,EAAE;MACX,CAAC,CAAC;IACJ,CAAC,MAAM;MACLJ,YAAY,CAACU,IAAI,IAAAC,MAAA,CAAAC,MAAA,KAAUF,IAAI;QAAEN,OAAO,EAAE;MAAK,EAAG,CAAC;IACrD;IAEA,OAAOS,MAAM;EACf,CAAC;EAGD,MAAME,cAAc,GAAG,MAAOC,QAAQ,IAAK;IACzChB,YAAY,CAACU,IAAI,IAAAC,MAAA,CAAAC,MAAA,KAAUF,IAAI;MAAEN,OAAO,EAAE;IAAI,EAAG,CAAC;IAClD,MAAMS,MAAM,GAAG,MAAMtB,QAAQ,CAACyB,QAAQ,CAAC;IAEvC,IAAIH,MAAM,CAACC,OAAO,EAAE;MAClBd,YAAY,CAAC;QACXC,eAAe,EAAE,IAAI;QACrBC,IAAI,EAAEW,MAAM,CAACX,IAAI;QACjBC,KAAK,EAAEU,MAAM,CAACV,KAAK;QACnBC,OAAO,EAAE;MACX,CAAC,CAAC;IACJ,CAAC,MAAM;MACLJ,YAAY,CAACU,IAAI,IAAAC,MAAA,CAAAC,MAAA,KAAUF,IAAI;QAAEN,OAAO,EAAE;MAAK,EAAG,CAAC;IACrD;IAEA,OAAOS,MAAM;EACf,CAAC;EAGD,MAAMI,YAAY,GAAG,MAAAA,CAAA,KAAY;IAC/BjB,YAAY,CAACU,IAAI,IAAAC,MAAA,CAAAC,MAAA,KAAUF,IAAI;MAAEN,OAAO,EAAE;IAAI,EAAG,CAAC;IAClD,MAAMS,MAAM,GAAG,MAAMrB,MAAM,CAAC,CAAC;IAE7B,IAAIqB,MAAM,CAACC,OAAO,EAAE;MAClBd,YAAY,CAAC;QACXC,eAAe,EAAE,KAAK;QACtBC,IAAI,EAAE,IAAI;QACVC,KAAK,EAAE,IAAI;QACXC,OAAO,EAAE;MACX,CAAC,CAAC;IACJ,CAAC,MAAM;MACLJ,YAAY,CAACU,IAAI,IAAAC,MAAA,CAAAC,MAAA,KAAUF,IAAI;QAAEN,OAAO,EAAE;MAAK,EAAG,CAAC;IACrD;IAEA,OAAOS,MAAM;EACf,CAAC;EAGD,MAAMK,KAAK,GAAG;IACZnB,SAAS;IACTT,KAAK,EAAEiB,WAAW;IAClBhB,QAAQ,EAAEwB,cAAc;IACxBvB,MAAM,EAAEyB;EACV,CAAC;EAED,OAAOtB,OAAA,CAACC,WAAW,CAACuB,QAAQ;IAACD,KAAK,EAAEA,KAAM;IAAApB,QAAA,EAAEA;EAAQ;IAAAsB,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OAAuB,CAAC;AAC9E,CAAC;AAGD,OAAO,MAAMC,OAAO,GAAGA,CAAA,KAAM;EAC3B,MAAMC,OAAO,GAAGtC,UAAU,CAACS,WAAW,CAAC;EACvC,IAAI,CAAC6B,OAAO,EAAE;IACZ,MAAM,IAAIC,KAAK,CAAC,6CAA6C,CAAC;EAChE;EACA,OAAOD,OAAO;AAChB,CAAC","ignoreList":[]},"metadata":{"hasCjsExports":false},"sourceType":"module","externalDependencies":[]}